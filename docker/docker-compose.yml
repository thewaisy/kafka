version: "3.9"
networks:
  data:
    external:
      name: waisy

x-kafka-common:
  &kafka-common
  image: waisy/kafka:2.8.1-2.13
  networks:
      - data
  depends_on:
    - zookeeper
  restart: always

services:
  zookeeper:
    image: zookeeper:3.5.9
    container_name: zookeeper
    hostname: zookeeper
    networks:
      - data
    ports:
      - "2181:2181"
      - "8080:8080"
    volumes:
      - ./conf/zoo.cfg:/conf/zoo.cfg
      - ~/data/zookeeper/zk1/data:/data

  kafka1:
    <<: *kafka-common
    container_name: kafka1
    hostname: kafka1
    ports:
      - "9092:9092"
    volumes:
    - ./kafka/config/kafka1.properties:/kafka/config/server.properties
    environment:
      MODE: 'server'

  kafka2:
    <<: *kafka-common
    container_name: kafka2
    hostname: kafka2
    ports:
      - "9093:9092"
    volumes:
    - ./kafka/config/kafka2.properties:/kafka/config/server.properties
    environment:
      MODE: 'server'
  
  kafka3:
    <<: *kafka-common
    container_name: kafka3
    hostname: kafka3
    ports:
      - "9094:9092"
    volumes:
    - ./kafka/config/kafka3.properties:/kafka/config/server.properties
    environment:
      MODE: 'server'

  cmak:
    container_name: cmak
    hostname: cmak
    image: waisy/cmak:3.0.0.5-v1
    networks:
      - data
    ports:
      - "9000:9000"
    volumes:
      - ./cmak/conf/application.conf:/etc/cmak/application.conf
    environment:
      ZK_HOSTS: 'zookeeper:2181'
    restart: always

  # zoo-navi:
  #   image: elkozmon/zoonavigator
  #   container_name: navi
  #   hostname: navi
  #   # networks:
  #   #   - data
  #   ports:
  #     - 9001:9000
  #   environment:
  #     HTTP_PORT: 9000